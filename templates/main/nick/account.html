{% extends 'main/nick/base.html' %}
{% load static %}

{% block content %}
    <div class="container-fluid account-wrapper py-4">
        <div class="row">
            <!-- Боковое меню, как на скриншоте -->
            <div class="col-md-3 col-lg-2">
                <aside class="account-sidebar">
                    <div class="profile-card text-center mb-4">
                        <div class="profile-avatar-block mb-2">
                            {% if profile_form.instance.avatar %}
                                <img class="profile-avatar" src="{{ profile_form.instance.avatar.url }}" alt="Avatar">
                            {% else %}
                                <div class="avatar-initial">{{ request.user.first_name|slice:":1"|upper }}</div>
                            {% endif %}
                        </div>
                        <div class="profile-username font-weight-bold">{{ request.user.get_full_name|default:request.user.username }}</div>
                        <div class="profile-email text-muted">{{ request.user.email }}</div>
                        <div class="profile-balance mt-2">
                            <span class="badge badge-success">Balance: ₹{{ registration_form.instance.balance|default:"0" }}</span>
                        </div>
                        <div class="profile-coupons mt-1 text-secondary">
                            Coupons: {{ registration_form.instance.coupons|default:"0" }}
                        </div>
                    </div>
                    <nav class="menu-list">
                        <ul class="list-group">
                            <li class="list-group-item"><a href="#dashboard" class="menu-link active">Dashboard</a></li>
                            <li class="list-group-item"><a href="#orders" class="menu-link">Orders</a></li>
                            <li class="list-group-item"><a href="#wishlist" class="menu-link">Wishlist</a></li>
                            <li class="list-group-item"><a href="#cart" class="menu-link">Cart</a></li>
                            <li class="list-group-item"><a href="#address" class="menu-link">Addresses</a></li>
                            <li class="list-group-item"><a href="#account-details" class="menu-link">Account Details</a>
                            </li>
                            <li class="list-group-item"><a href="{% url 'logout' %}" class="menu-link">Logout</a></li>
                        </ul>
                    </nav>
                </aside>
            </div>

            <!-- Основная секция аккаунта -->
            <div class="col-md-9 col-lg-10">
                <div class="account-main">
                    <!-- Блок приветствия -->
                    <div class="user-greeting mb-4">
                        <h2>Hello, <span>{{ request.user.get_full_name|default:request.user.username }}</span></h2>
                        <div class="text-muted">You have {{ orders|length }} orders | Bonus
                            ₹{{ registration_form.instance.balance|default:"0" }}</div>
                    </div>

                    <!-- Быстрое меню (баланс, корзина, настройки) -->
                    <div class="quick-info-block d-flex flex-wrap align-items-center mb-4">
                        <div class="info-item mr-5">
                            <span class="label">Balance: </span>
                            <span class="value font-weight-bold">₹{{ registration_form.instance.balance|default:"0" }}</span>
                        </div>
                        <div class="info-item mr-5">
                            <span class="label">Cart: </span>
                            <a href="{% url 'cart' %}" class="cart-badge badge badge-info">{{ cart_items|length }}
                                items</a>
                        </div>
                        <div class="info-item">
                            <a href="#account-details" class="btn btn-outline-primary btn-sm">Account settings</a>
                        </div>
                    </div>

                    <!-- Основная секция с табами / карточками -->
                    <div class="row">
                        <div class="col-lg-8 col-md-12">
                            <section id="orders" class="orders-section mb-4">
                                <h4 class="section-title">My Orders</h4>
                                {% if orders %}
                                    <div class="orders-list">
                                        {% for order in orders %}
                                            <div class="order-card">
                                                <strong>Order #{{ order.number }}</strong> –
                                                <span>{{ order.items_count }} items</span> |
                                                <span>Total: ₹{{ order.total }}</span>
                                                <span class="ml-2 font-italic text-muted">({{ order.date }})</span>
                                                <span class="badge badge-{% if order.status == 'Draft' %}secondary{% else %}success{% endif %} ml-2">{{ order.status }}</span>
                                                <a href="{% url 'order_view' order.pk %}"
                                                   class="btn btn-sm btn-outline-primary ml-3">View</a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="alert alert-info">You have no orders.</div>
                                {% endif %}
                            </section>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <!-- Детали профиля и настройка -->
                            <section id="account-details" class="account-details-section mb-4 card p-3">
                                <h4 class="section-title mb-3">Profile & Settings</h4>
                                <form method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="{{ user_form.first_name.id_for_label }}">First Name</label>
                                        {{ user_form.first_name }}
                                        {% if user_form.first_name.errors %}
                                            <div class="text-danger">{{ user_form.first_name.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{ user_form.last_name.id_for_label }}">Last Name</label>
                                        {{ user_form.last_name }}
                                        {% if user_form.last_name.errors %}
                                            <div class="text-danger">{{ user_form.last_name.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{ user_form.email.id_for_label }}">Email</label>
                                        {{ user_form.email }}
                                        {% if user_form.email.errors %}
                                            <div class="text-danger">{{ user_form.email.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{ profile_form.bio.id_for_label }}">Bio</label>
                                        {{ profile_form.bio }}
                                        {% if profile_form.bio.errors %}
                                            <div class="text-danger">{{ profile_form.bio.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{ profile_form.birthday.id_for_label }}">Birthday</label>
                                        {{ profile_form.birthday }}
                                        {% if profile_form.birthday.errors %}
                                            <div class="text-danger">{{ profile_form.birthday.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label for="{{ profile_form.website.id_for_label }}">Website</label>
                                        {{ profile_form.website }}
                                        {% if profile_form.website.errors %}
                                            <div class="text-danger">{{ profile_form.website.errors }}</div>{% endif %}
                                    </div>
                                    <div class="form-group">
                                        <label>Avatar</label>
                                        {{ profile_form.avatar }}
                                        {% if profile_form.avatar.errors %}
                                            <div class="text-danger">{{ profile_form.avatar.errors }}</div>{% endif %}
                                    </div>
                                    <div class="mt-3 text-right">
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </section>
                        </div>
                    </div>

                    <!-- Доп. настройки, управлением адресами, и пр. можно добавить как отдельные секции/табы как на фото -->
                </div>
            </div>
        </div>
    </div>
{% endblock %}
